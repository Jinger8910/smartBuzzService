var busList = [
    {
        "route_id":"blue",
        "stop_id":"fitthall_a",
        "stop_name":"Fitten Hall",
        "stop_lat":"33.778274",
        "stop_lon":"-84.404191",
        "trip_id":"Counterclo",
        "reference_stop_id":"1"
    },
    {
        "route_id":"blue",
        "stop_id":"mcmil8th",
        "stop_name":"McMillian St & 8th St",
        "stop_lat":"33.779599",
        "stop_lon":"-84.404164",
        "trip_id":"Counterclo",
        "reference_stop_id":"2"
    },
    {
        "route_id":"blue",
        "stop_id":"8thhemp",
        "stop_name":"8th St & Hemphill Ave",
        "stop_lat":"33.779631",
        "stop_lon":"-84.40274",
        "trip_id":"Counterclo",
        "reference_stop_id":"3"
    },
    {
        "route_id":"blue",
        "stop_id":"reccent",
        "stop_name":"CRC",
        "stop_lat":"33.7751",
        "stop_lon":"-84.40265",
        "trip_id":"Counterclo",
        "reference_stop_id":"4"
    },
    {
        "route_id":"blue",
        "stop_id":"studcent",
        "stop_name":"Student Center",
        "stop_lat":"33.77335",
        "stop_lon":"-84.39917",
        "trip_id":"Counterclo",
        "reference_stop_id":"5"
    },
    {
        "route_id":"blue",
        "stop_id":"hubfers",
        "stop_name":"Hub & Ferst Dr",
        "stop_lat":"33.772842",
        "stop_lon":"-84.397359",
        "trip_id":"Counterclo",
        "reference_stop_id":"6"
    },
    {
        "route_id":"blue",
        "stop_id":"cherfers",
        "stop_name":"Cherry St & Ferst Dr",
        "stop_lat":"33.77234",
        "stop_lon":"-84.3957",
        "trip_id":"Counterclo",
        "reference_stop_id":"7"
    },
    {
        "route_id":"blue",
        "stop_id":"naveapts_a",
        "stop_name":"North Avenue Apartments",
        "stop_lat":"33.77019",
        "stop_lon":"-84.39174",
        "trip_id":"Counterclo",
        "reference_stop_id":"8"
    },
    {
        "route_id":"blue",
        "stop_id":"technorth",
        "stop_name":"Techwood Dr & North Ave",
        "stop_lat":"33.771857",
        "stop_lon":"-84.39192",
        "trip_id":"Counterclo",
        "reference_stop_id":"9"
    },
    {
        "route_id":"blue",
        "stop_id":"3rdtech",
        "stop_name":"Techwood Dr & 3rd Street",
        "stop_lat":"33.774061",
        "stop_lon":"-84.39192",
        "trip_id":"Counterclo",
        "reference_stop_id":"10"
    },
    {
        "route_id":"blue",
        "stop_id":"4thtech",
        "stop_name":"Techwood Dr & 4th Street",
        "stop_lat":"33.775066",
        "stop_lon":"-84.39194",
        "trip_id":"Counterclo",
        "reference_stop_id":"11"
    },
    {
        "route_id":"blue",
        "stop_id":"5thtech",
        "stop_name":"Techwood Dr & 5th Street",
        "stop_lat":"33.776401",
        "stop_lon":"-84.392123",
        "trip_id":"Counterclo",
        "reference_stop_id":"12"
    },
    {
        "route_id":"blue",
        "stop_id":"fersfowl",
        "stop_name":"Ferst Dr & Fowler St",
        "stop_lat":"33.776949",
        "stop_lon":"-84.394234",
        "trip_id":"Counterclo",
        "reference_stop_id":"13"
    },
    {
        "route_id":"blue",
        "stop_id":"fersklau",
        "stop_name":"Ferst Dr & Cherry St",
        "stop_lat":"33.777634",
        "stop_lon":"-84.39575",
        "trip_id":"Counterclo",
        "reference_stop_id":"14"
    },
    {
        "route_id":"blue",
        "stop_id":"fersatla",
        "stop_name":"Ferst Dr & Atlantic Dr",
        "stop_lat":"33.77832",
        "stop_lon":"-84.398083",
        "trip_id":"Counterclo",
        "reference_stop_id":"15"
    },
    {
        "route_id":"blue",
        "stop_id":"fersstat_ob",
        "stop_name":"Ferst Dr & State St",
        "stop_lat":"33.778436",
        "stop_lon":"-84.399961",
        "trip_id":"Counterclo",
        "reference_stop_id":"16"
    },
    {
        "route_id":"blue",
        "stop_id":"fershemp_ob",
        "stop_name":"Ferst Dr & Hemphill Ave",
        "stop_lat":"33.778141",
        "stop_lon":"-84.401829",
        "trip_id":"Counterclo",
        "reference_stop_id":"17"
    },
    {
        "route_id":"blue",
        "stop_id":"fitthall_a",
        "stop_name":"Fitten Hall",
        "stop_lat":"33.778274",
        "stop_lon":"-84.404191",
        "trip_id":"Counterclo",
        "reference_stop_id":"18"
    },
    {
        "route_id":"green",
        "stop_id":"tep_a",
        "stop_name":"TEP",
        "stop_lat":"33.7695",
        "stop_lon":"-84.402752",
        "trip_id":"gr_to14th",
        "reference_stop_id":"19"
    },
    {
        "route_id":"green",
        "stop_id":"tranhub",
        "stop_name":"Transit Hub",
        "stop_lat":"33.773226",
        "stop_lon":"-84.397016",
        "trip_id":"gr_to14th",
        "reference_stop_id":"20"
    },
    {
        "route_id":"green",
        "stop_id":"studtech",
        "stop_name":"Student Center at Tech Pkwy",
        "stop_lat":"33.773143",
        "stop_lon":"-84.3997",
        "trip_id":"gr_to14th",
        "reference_stop_id":"21"
    },
    {
        "route_id":"green",
        "stop_id":"creccent",
        "stop_name":"CRC",
        "stop_lat":"33.774997",
        "stop_lon":"-84.402359",
        "trip_id":"gr_to14th",
        "reference_stop_id":"22"
    },
    {
        "route_id":"green",
        "stop_id":"fershemp",
        "stop_name":"Ferst Dr & Hemphill Ave",
        "stop_lat":"33.778363",
        "stop_lon":"-84.401007",
        "trip_id":"gr_to14th",
        "reference_stop_id":"23"
    },
    {
        "route_id":"green",
        "stop_id":"fersstat",
        "stop_name":"Ferst Dr & State St",
        "stop_lat":"33.778293",
        "stop_lon":"-84.399279",
        "trip_id":"gr_to14th",
        "reference_stop_id":"24"
    },
    {
        "route_id":"green",
        "stop_id":"ndec",
        "stop_name":"North Deck",
        "stop_lat":"33.780233",
        "stop_lon":"-84.39905",
        "trip_id":"gr_to14th",
        "reference_stop_id":"25"
    },
    {
        "route_id":"green",
        "stop_id":"10thhemp",
        "stop_name":"Hemphill Ave & 10th St",
        "stop_lat":"33.781619",
        "stop_lon":"-84.404082",
        "trip_id":"gr_to14th",
        "reference_stop_id":"26"
    },
    {
        "route_id":"green",
        "stop_id":"hempcurr",
        "stop_name":"Hemphill Ave & Curran St",
        "stop_lat":"33.784665",
        "stop_lon":"-84.405937",
        "trip_id":"gr_to14th",
        "reference_stop_id":"27"
    },
    {
        "route_id":"green",
        "stop_id":"14thbusy_a",
        "stop_name":"14th St Bus Yard",
        "stop_lat":"33.78617",
        "stop_lon":"-84.405241",
        "trip_id":"gr_to14th",
        "reference_stop_id":"28"
    },
    {
        "route_id":"green",
        "stop_id":"14thbusy_a",
        "stop_name":"14th St Bus Yard",
        "stop_lat":"33.78617",
        "stop_lon":"-84.405241",
        "trip_id":"tep",
        "reference_stop_id":"29"
    },
    {
        "route_id":"green",
        "stop_id":"14thstat",
        "stop_name":"14th St & State St",
        "stop_lat":"33.78613",
        "stop_lon":"-84.398799",
        "trip_id":"tep",
        "reference_stop_id":"30"
    },
    {
        "route_id":"green",
        "stop_id":"gcat",
        "stop_name":"GCATT",
        "stop_lat":"33.78628",
        "stop_lon":"-84.39559",
        "trip_id":"tep",
        "reference_stop_id":"31"
    },
    {
        "route_id":"green",
        "stop_id":"glc",
        "stop_name":"GLC",
        "stop_lat":"33.78158",
        "stop_lon":"-84.39645",
        "trip_id":"tep",
        "reference_stop_id":"32"
    },
    {
        "route_id":"green",
        "stop_id":"bakebldg",
        "stop_name":"Baker Bldg",
        "stop_lat":"33.780355",
        "stop_lon":"-84.39928",
        "trip_id":"tep",
        "reference_stop_id":"33"
    },
    {
        "route_id":"green",
        "stop_id":"fersstat_ob",
        "stop_name":"Ferst Dr & State St",
        "stop_lat":"33.778436",
        "stop_lon":"-84.399961",
        "trip_id":"tep",
        "reference_stop_id":"34"
    },
    {
        "route_id":"green",
        "stop_id":"fershemp_ob",
        "stop_name":"Ferst Dr & Hemphill Ave",
        "stop_lat":"33.778141",
        "stop_lon":"-84.401829",
        "trip_id":"tep",
        "reference_stop_id":"35"
    },
    {
        "route_id":"green",
        "stop_id":"reccent",
        "stop_name":"CRC",
        "stop_lat":"33.7751",
        "stop_lon":"-84.40265",
        "trip_id":"tep",
        "reference_stop_id":"36"
    },
    {
        "route_id":"green",
        "stop_id":"studcent",
        "stop_name":"Student Center",
        "stop_lat":"33.77335",
        "stop_lon":"-84.39917",
        "trip_id":"tep",
        "reference_stop_id":"37"
    },
    {
        "route_id":"green",
        "stop_id":"hubfers",
        "stop_name":"HUB & Ferst Dr",
        "stop_lat":"33.772842",
        "stop_lon":"-84.397359",
        "trip_id":"tep",
        "reference_stop_id":"38"
    },
    {
        "route_id":"green",
        "stop_id":"cherfers",
        "stop_name":"Cherry St & Ferst Dr",
        "stop_lat":"33.77234",
        "stop_lon":"-84.3957",
        "trip_id":"tep",
        "reference_stop_id":"39"
    },
    {
        "route_id":"green",
        "stop_id":"nara",
        "stop_name":"NARA",
        "stop_lat":"33.77072",
        "stop_lon":"-84.403324",
        "trip_id":"tep",
        "reference_stop_id":"40"
    },
    {
        "route_id":"green",
        "stop_id":"tep_a",
        "stop_name":"TEP",
        "stop_lat":"33.7695",
        "stop_lon":"-84.402752",
        "trip_id":"tep",
        "reference_stop_id":"41"
    },
    {
        "route_id":"night",
        "stop_id":"fitthall_a",
        "stop_name":"Fitten Hall",
        "stop_lat":"33.778282",
        "stop_lon":"-84.404193",
        "trip_id":"night",
        "reference_stop_id":"42"
    },
    {
        "route_id":"night",
        "stop_id":"8thhemp",
        "stop_name":"8th St & Hemphill Ave",
        "stop_lat":"33.779665",
        "stop_lon":"-84.402895",
        "trip_id":"night",
        "reference_stop_id":"43"
    },
    {
        "route_id":"night",
        "stop_id":"creccent_ob",
        "stop_name":"Recreation Center",
        "stop_lat":"33.7751",
        "stop_lon":"-84.40265",
        "trip_id":"night",
        "reference_stop_id":"44"
    },
    {
        "route_id":"night",
        "stop_id":"tranhub_b",
        "stop_name":"Transit HUB",
        "stop_lat":"33.773302",
        "stop_lon":"-84.397026",
        "trip_id":"night",
        "reference_stop_id":"45"
    },
    {
        "route_id":"night",
        "stop_id":"technorth_ob",
        "stop_name":"Techwood Dr & North Ave",
        "stop_lat":"0",
        "stop_lon":"0",
        "trip_id":"night",
        "reference_stop_id":"46"
    },
    {
        "route_id":"night",
        "stop_id":"bobfow",
        "stop_name":"Bobby Dodd\/Fowler",
        "stop_lat":"33.773913",
        "stop_lon":"-84.393282",
        "trip_id":"tofittenhall",
        "reference_stop_id":"47"
    },
    {
        "route_id":"night",
        "stop_id":"technorth_ib",
        "stop_name":"Techwood Dr & North Ave",
        "stop_lat":"33.771353",
        "stop_lon":"-84.392075",
        "trip_id":"tofittenhall",
        "reference_stop_id":"48"
    },
    {
        "route_id":"night",
        "stop_id":"creccent_ib",
        "stop_name":"Recreation Center",
        "stop_lat":"33.774997",
        "stop_lon":"-84.402359",
        "trip_id":"tofittenhall",
        "reference_stop_id":"49"
    },
    {
        "route_id":"red",
        "stop_id":"fitthall_a",
        "stop_name":"Fitten Hall",
        "stop_lat":"33.778274",
        "stop_lon":"-84.404191",
        "trip_id":"Clockwise",
        "reference_stop_id":"50"
    },
    {
        "route_id":"red",
        "stop_id":"mcmil8th",
        "stop_name":"McMillian St & 8th St",
        "stop_lat":"33.779599",
        "stop_lon":"-84.404164",
        "trip_id":"Clockwise",
        "reference_stop_id":"51"
    },
    {
        "route_id":"red",
        "stop_id":"8thhemp",
        "stop_name":"8th St & Hemphill Ave",
        "stop_lat":"33.779631",
        "stop_lon":"-84.40274",
        "trip_id":"Clockwise",
        "reference_stop_id":"52"
    },
    {
        "route_id":"red",
        "stop_id":"fershemp",
        "stop_name":"Ferst Dr & Hemphill Ave",
        "stop_lat":"33.778363",
        "stop_lon":"-84.401007",
        "trip_id":"Clockwise",
        "reference_stop_id":"53"
    },
    {
        "route_id":"red",
        "stop_id":"fersstat",
        "stop_name":"Ferst Dr & State St",
        "stop_lat":"33.778293",
        "stop_lon":"-84.399279",
        "trip_id":"Clockwise",
        "reference_stop_id":"54"
    },
    {
        "route_id":"red",
        "stop_id":"fersatla",
        "stop_name":"Ferst Dr & Atlantic Dr",
        "stop_lat":"33.77819",
        "stop_lon":"-84.397491",
        "trip_id":"Clockwise",
        "reference_stop_id":"55"
    },
    {
        "route_id":"red",
        "stop_id":"klaubldg",
        "stop_name":"Ferst Dr & Cherry St",
        "stop_lat":"33.777439",
        "stop_lon":"-84.395508",
        "trip_id":"Clockwise",
        "reference_stop_id":"56"
    },
    {
        "route_id":"red",
        "stop_id":"fersfowl",
        "stop_name":"Ferst Dr & Fowler St",
        "stop_lat":"33.776925",
        "stop_lon":"-84.393671",
        "trip_id":"Clockwise",
        "reference_stop_id":"57"
    },
    {
        "route_id":"red",
        "stop_id":"tech5th",
        "stop_name":"Techwood Dr & 5th St",
        "stop_lat":"33.776401",
        "stop_lon":"-84.392123",
        "trip_id":"Clockwise",
        "reference_stop_id":"58"
    },
    {
        "route_id":"red",
        "stop_id":"tech4th",
        "stop_name":"Techwood Dr & 4th St",
        "stop_lat":"33.774954",
        "stop_lon":"-84.392049",
        "trip_id":"Clockwise",
        "reference_stop_id":"59"
    },
    {
        "route_id":"red",
        "stop_id":"techbob",
        "stop_name":"Techwood Dr & Bobby Dodd Way",
        "stop_lat":"33.773667",
        "stop_lon":"-84.39205",
        "trip_id":"Clockwise",
        "reference_stop_id":"60"
    },
    {
        "route_id":"red",
        "stop_id":"technorth",
        "stop_name":"Techwood Dr & North Ave",
        "stop_lat":"33.77145",
        "stop_lon":"-84.3921",
        "trip_id":"Clockwise",
        "reference_stop_id":"61"
    },
    {
        "route_id":"red",
        "stop_id":"naveapts_a",
        "stop_name":"North Avenue Apartments",
        "stop_lat":"33.76994",
        "stop_lon":"-84.391629",
        "trip_id":"Clockwise",
        "reference_stop_id":"62"
    },
    {
        "route_id":"red",
        "stop_id":"cherfers",
        "stop_name":"Cherry St & Ferst Dr",
        "stop_lat":"33.772284",
        "stop_lon":"-84.39548",
        "trip_id":"Clockwise",
        "reference_stop_id":"63"
    },
    {
        "route_id":"red",
        "stop_id":"centrstud",
        "stop_name":"Student Center",
        "stop_lat":"33.77346",
        "stop_lon":"-84.399159",
        "trip_id":"Clockwise",
        "reference_stop_id":"64"
    },
    {
        "route_id":"red",
        "stop_id":"hubfers",
        "stop_name":"Hub & Ferst Dr",
        "stop_lat":"33.77276",
        "stop_lon":"-84.396983",
        "trip_id":"Clockwise",
        "reference_stop_id":"65"
    },
    {
        "route_id":"red",
        "stop_id":"creccent",
        "stop_name":"CRC",
        "stop_lat":"33.774997",
        "stop_lon":"-84.402359",
        "trip_id":"Clockwise",
        "reference_stop_id":"66"
    },
    {
        "route_id":"red",
        "stop_id":"fitthall_a",
        "stop_name":"Fitten Hall",
        "stop_lat":"33.778274",
        "stop_lon":"-84.404191",
        "trip_id":"Clockwise",
        "reference_stop_id":"67"
    },
    {
        "route_id":"trolley",
        "stop_id":"marta_a",
        "stop_name":"MARTA Midtown Station",
        "stop_lat":"33.78082",
        "stop_lon":"-84.38641",
        "trip_id":"tohub",
        "reference_stop_id":"68"
    },
    {
        "route_id":"trolley",
        "stop_id":"publix",
        "stop_name":"Publix Supermarket",
        "stop_lat":"33.7806",
        "stop_lon":"-84.388818",
        "trip_id":"tohub",
        "reference_stop_id":"69"
    },
    {
        "route_id":"trolley",
        "stop_id":"techsqua",
        "stop_name":"Technology Square",
        "stop_lat":"33.77692",
        "stop_lon":"-84.38978",
        "trip_id":"tohub",
        "reference_stop_id":"70"
    },
    {
        "route_id":"trolley",
        "stop_id":"tech5rec",
        "stop_name":"Techwood Dr & 5th St",
        "stop_lat":"33.776896",
        "stop_lon":"-84.391581",
        "trip_id":"tohub",
        "reference_stop_id":"71"
    },
    {
        "route_id":"trolley",
        "stop_id":"fersfowl",
        "stop_name":"Ferst Dr & Fowler St",
        "stop_lat":"33.776949",
        "stop_lon":"-84.394234",
        "trip_id":"tohub",
        "reference_stop_id":"72"
    },
    {
        "route_id":"trolley",
        "stop_id":"fersklau",
        "stop_name":"Ferst Dr & Cherry St",
        "stop_lat":"33.777634",
        "stop_lon":"-84.39575",
        "trip_id":"tohub",
        "reference_stop_id":"73"
    },
    {
        "route_id":"trolley",
        "stop_id":"fersatla",
        "stop_name":"Ferst Dr & Atlantic Dr",
        "stop_lat":"33.77832",
        "stop_lon":"-84.398083",
        "trip_id":"tohub",
        "reference_stop_id":"74"
    },
    {
        "route_id":"trolley",
        "stop_id":"fershemp_ob",
        "stop_name":"Ferst Dr & Hemphill Ave",
        "stop_lat":"33.778141",
        "stop_lon":"-84.401829",
        "trip_id":"tohub",
        "reference_stop_id":"75"
    },
    {
        "route_id":"trolley",
        "stop_id":"reccent",
        "stop_name":"Recreation Center - Ferst Dr",
        "stop_lat":"33.7751",
        "stop_lon":"-84.40265",
        "trip_id":"tohub",
        "reference_stop_id":"76"
    },
    {
        "route_id":"trolley",
        "stop_id":"studcent",
        "stop_name":"Student Center",
        "stop_lat":"33.77335",
        "stop_lon":"-84.39917",
        "trip_id":"tohub",
        "reference_stop_id":"77"
    },
    {
        "route_id":"trolley",
        "stop_id":"tranhub",
        "stop_name":"Transit Hub",
        "stop_lat":"33.773261",
        "stop_lon":"-84.397058",
        "trip_id":"tohub",
        "reference_stop_id":"78"
    },
    {
        "route_id":"trolley",
        "stop_id":"tranhub",
        "stop_name":"Transit Hub",
        "stop_lat":"33.773261",
        "stop_lon":"-84.397058",
        "trip_id":"tomarta",
        "reference_stop_id":"79"
    },
    {
        "route_id":"trolley",
        "stop_id":"centrstud",
        "stop_name":"Student Center",
        "stop_lat":"33.77335",
        "stop_lon":"-84.39917",
        "trip_id":"tomarta",
        "reference_stop_id":"80"
    },
    {
        "route_id":"trolley",
        "stop_id":"creccent",
        "stop_name":"CRC",
        "stop_lat":"33.774997",
        "stop_lon":"-84.402359",
        "trip_id":"tomarta",
        "reference_stop_id":"81"
    },
    {
        "route_id":"trolley",
        "stop_id":"fershemp",
        "stop_name":"Ferst Dr & Hemphill Ave",
        "stop_lat":"33.778363",
        "stop_lon":"-84.401007",
        "trip_id":"tomarta",
        "reference_stop_id":"82"
    },
    {
        "route_id":"trolley",
        "stop_id":"fersatla",
        "stop_name":"Ferst Dr & Atlantic Dr",
        "stop_lat":"33.77819",
        "stop_lon":"-84.397491",
        "trip_id":"tomarta",
        "reference_stop_id":"83"
    },
    {
        "route_id":"trolley",
        "stop_id":"klaubldg",
        "stop_name":"Ferst Dr & Cherry St",
        "stop_lat":"33.777439",
        "stop_lon":"-84.395508",
        "trip_id":"tomarta",
        "reference_stop_id":"84"
    },
    {
        "route_id":"trolley",
        "stop_id":"fersfowl",
        "stop_name":"Ferst Dr & Fowler St",
        "stop_lat":"33.776925",
        "stop_lon":"-84.393671",
        "trip_id":"tomarta",
        "reference_stop_id":"85"
    },
    {
        "route_id":"trolley",
        "stop_id":"tech5mrt",
        "stop_name":"Techwood Dr & 5th St",
        "stop_lat":"33.776878",
        "stop_lon":"-84.391914",
        "trip_id":"tomarta",
        "reference_stop_id":"86"
    },
    {
        "route_id":"trolley",
        "stop_id":"techsqua_ib",
        "stop_name":"Technology Square",
        "stop_lat":"33.7768",
        "stop_lon":"-84.38975",
        "trip_id":"tomarta",
        "reference_stop_id":"87"
    },
    {
        "route_id":"trolley",
        "stop_id":"duprmrt",
        "stop_name":"College of Management",
        "stop_lat":"33.77678",
        "stop_lon":"-84.38749",
        "trip_id":"tomarta",
        "reference_stop_id":"88"
    },
    {
        "route_id":"trolley",
        "stop_id":"wpe7mrt",
        "stop_name":"Academy of Medicine",
        "stop_lat":"33.778536",
        "stop_lon":"-84.38724",
        "trip_id":"tomarta",
        "reference_stop_id":"89"
    },
    {
        "route_id":"trolley",
        "stop_id":"marta_a",
        "stop_name":"MARTA Midtown Station",
        "stop_lat":"33.78082",
        "stop_lon":"-84.38641",
        "trip_id":"tomarta",
        "reference_stop_id":"90"
    }
];

// Contains method
Array.prototype.contains = function(elem)
{
    for (var i in this)
    {
        if (this[i] == elem) return true;
    }
    return false;
}

function rad(d) {
    return d * Math.PI / 180.0;
}

function walkDist(lat1, lng1, lat2, lng2) {
    var radLat1 = rad(lat1);
    var radLat2 = rad(lat2);
    var radLng1 = rad(lng1);
    var radLng2 = rad(lng2);

    var s = 2 * Math.sin(Math.sqrt(Math.pow(Math.sin((radLat1 - radLat2)/2),2) +
            Math.cos(radLat1) * Math.cos(radLat2) * Math.pow(Math.sin((radLng1 - radLng2)/2),2)));
    s = s * 6378.137;
    s = Math.round(s * 10000) / 10000;
    return s * 0.621371192;
}

// direct method
function direct(origin_stopId, dest_stopId) {
    var busToTake = [];
    var originLine = [];
    var destLine = [];

    for (var i = 0; i < busList.length; i++) {
        var temp = {
            "route_id": busList[i].route_id,
            "trip_id": busList[i].trip_id,
            "reference_stop_id": busList[i].reference_stop_id
        }
        if (busList[i].stop_id === origin_stopId) {
            originLine.push(temp);
        }
    }

    for (var j = 0; j < busList.length; j++) {
        var temp = {
            "route_id": busList[j].route_id,
            "trip_id": busList[j].trip_id,
            "reference_stop_id": busList[j].reference_stop_id
        }
        if (busList[j].stop_id === dest_stopId) {
            destLine.push(temp);
        }
    }

    for (var m = 0; m < originLine.length; m++) {
        for (var n = 0; n < destLine.length; n++) {
            if (originLine[m].route_id === destLine[n].route_id && originLine[m].trip_id === destLine[n].trip_id && originLine[m].reference_stop_id < destLine[n].reference_stop_id) {
                var temp = {
                    "bus_to_take": destLine[n].route_id,
                    "direction": destLine[n].trip_id
                }
                busToTake.push(temp);
            }
        }
    }

    return(busToTake);
}

// direct method ends here

// transfer method starts from here
function transfer(origin_stopId, dest_stopId) {
    // get all lineIDs that pass the origin stop
    var origin_lineOptionId = [];
    for (var a = 0; a < busList.length; a++) {
        if (busList[a].stop_id === origin_stopId) {
            var temp = {
                "route_id": busList[a].route_id,
                "trip_id": busList[a].trip_id
            }
            origin_lineOptionId.push(temp);
        }
    }

    // get all stops from the lines
    var origin_toNextStop = [];
    for (var b = 0; b < origin_lineOptionId.length; b++) {
        if (origin_lineOptionId[b].route_id === "blue") {
            for (var c = 0; c < 18; c++) {
                var temp = {
                    "stop_id": busList[c].stop_id,
                    "stop_name": busList[c].stop_name
                }
                if (!origin_toNextStop.contains(temp)) {
                    origin_toNextStop.push(temp);
                }
            }
        }
        if (origin_lineOptionId[b].route_id === "green" && origin_lineOptionId[b].trip_id === "gr_to14th") {
            for (var e = 18; e < 28; e++) {
                var temp = {
                    "stop_id": busList[e].stop_id,
                    "stop_name": busList[e].stop_name
                }
                if (!origin_toNextStop.contains(temp)) {
                    origin_toNextStop.push(temp);
                }
            }
        }
        if (origin_lineOptionId[b].route_id === "green" && origin_lineOptionId[b].trip_id === "tep") {
            for (var d = 28; d < 41; d++) {
                var temp = {
                    "stop_id": busList[d].stop_id,
                    "stop_name": busList[d].stop_name
                }
                if (!origin_toNextStop.contains(temp)) {
                    origin_toNextStop.push(temp);
                }
            }
        }
        if (origin_lineOptionId[b].route_id === "night" && origin_lineOptionId[b].trip_id === "night") {
            for (var f = 41; f < 46; f++) {
                var temp = {
                    "stop_id": busList[f].stop_id,
                    "stop_name": busList[f].stop_name
                }
                if (!origin_toNextStop.contains(temp)) {
                    origin_toNextStop.push(temp);
                }
            }
        }
        if (origin_lineOptionId[b].route_id === "night" && origin_lineOptionId[b].trip_id === "tofittenhall") {
            for (var g = 46; g < 49; g++) {
                var temp = {
                    "stop_id": busList[g].stop_id,
                    "stop_name": busList[g].stop_name
                }
                if (!origin_toNextStop.contains(temp)) {
                    origin_toNextStop.push(temp);
                }

            }
        }
        if (origin_lineOptionId[b].route_id === "red") {
            for (var h = 49; h < 67; h++) {
                var temp = {
                    "stop_id": busList[h].stop_id,
                    "stop_name": busList[h].stop_name
                }
                if (!origin_toNextStop.contains(temp)) {
                    origin_toNextStop.push(temp);
                }
            }
        }
        if (origin_lineOptionId[b].route_id === "trolley" && origin_lineOptionId[b].trip_id === "tohub") {
            for (var k = 67; k < 78; k++) {
                var temp = {
                    "stop_id": busList[k].stop_id,
                    "stop_name": busList[k].stop_name
                }
                if (!origin_toNextStop.contains(temp)) {
                    origin_toNextStop.push(temp);
                }
            }
        }
        if (origin_lineOptionId[b].route_id === "trolley" && origin_lineOptionId[b].trip_id === "tomarta") {
            for (var l = 78; l < 90; l++) {
                var temp = {
                    "stop_id": busList[l].stop_id,
                    "stop_name": busList[l].stop_name
                }
                if (!origin_toNextStop.contains(temp)) {
                    origin_toNextStop.push(temp);
                }
            }
        }
    }

    // get all lineIDs that pass the destination stop
    var dest_lineOptionId = [];
    for (var m = 0; m < busList.length; m++) {
        if (busList[m].stop_id === dest_stopId) {
            var temp = {
                "route_id": busList[m].route_id,
                "trip_id": busList[m].trip_id
            }
            dest_lineOptionId.push(temp);
        }
    }

    // get all stops from the lines
    var dest_toNextStop = [];
    for (var b = 0; b < dest_lineOptionId.length; b++) {
        if (dest_lineOptionId[b].route_id === "blue") {
            for (var c = 0; c < 18; c++) {
                var temp = {
                    "stop_id": busList[c].stop_id,
                    "stop_name": busList[c].stop_name
                }
                if (!dest_toNextStop.contains(temp)) {
                    dest_toNextStop.push(temp);
                }
            }
        }
        if (dest_lineOptionId[b].route_id === "green" && dest_lineOptionId[b].trip_id === "gr_to14th") {
            for (var e = 18; e < 28; e++) {
                var temp = {
                    "stop_id": busList[e].stop_id,
                    "stop_name": busList[e].stop_name
                }
                if (!dest_toNextStop.contains(temp)) {
                    dest_toNextStop.push(temp);
                }
            }
        }
        if (dest_lineOptionId[b].route_id === "green" && dest_lineOptionId[b].trip_id === "tep") {
            for (var d = 28; d < 41; d++) {
                var temp = {
                    "stop_id": busList[d].stop_id,
                    "stop_name": busList[d].stop_name
                }
                if (!dest_toNextStop.contains(temp)) {
                    dest_toNextStop.push(temp);
                }
            }
        }
        if (dest_lineOptionId[b].route_id === "night" && dest_lineOptionId[b].trip_id === "night") {
            for (var f = 41; f < 46; f++) {
                var temp = {
                    "stop_id": busList[f].stop_id,
                    "stop_name": busList[f].stop_name
                }
                if (!dest_toNextStop.contains(temp)) {
                    dest_toNextStop.push(temp);
                }
            }
        }
        if (dest_lineOptionId[b].route_id === "night" && dest_lineOptionId[b].trip_id === "tofittenhall") {
            for (var g = 46; g < 49; g++) {
                var temp = {
                    "stop_id": busList[g].stop_id,
                    "stop_name": busList[g].stop_name
                }
                if (!dest_toNextStop.contains(temp)) {
                    dest_toNextStop.push(temp);
                }

            }
        }
        if (dest_lineOptionId[b].route_id === "red") {
            for (var h = 49; h < 67; h++) {
                var temp = {
                    "stop_id": busList[h].stop_id,
                    "stop_name": busList[h].stop_name
                }
                if (!dest_toNextStop.contains(temp)) {
                    dest_toNextStop.push(temp);
                }
            }
        }
        if (dest_lineOptionId[b].route_id === "trolley" && dest_lineOptionId[b].trip_id === "tohub") {
            for (var k = 67; k < 78; k++) {
                var temp = {
                    "stop_id": busList[k].stop_id,
                    "stop_name": busList[k].stop_name
                }
                if (!dest_toNextStop.contains(temp)) {
                    dest_toNextStop.push(temp);
                }
            }
        }
        if (dest_lineOptionId[b].route_id === "trolley" && dest_lineOptionId[b].trip_id === "tomarta") {
            for (var l = 78; l < 90; l++) {
                var temp = {
                    "stop_id": busList[l].stop_id,
                    "stop_name": busList[l].stop_name
                }
                if (!dest_toNextStop.contains(temp)) {
                    dest_toNextStop.push(temp);
                }
            }
        }
    }

    var transfer_stop = [];
    for (var x = 0; x < origin_toNextStop.length; x++) {
        for (var y = 0; y < dest_toNextStop.length; y++) {
            if (origin_toNextStop[x].stop_id === dest_toNextStop[y].stop_id) {
                transfer_stop.push(dest_toNextStop[y]);
            }
        }
    }

    var busToTake = [];
    for (var u = 0; u < transfer_stop.length; u++) {
        var tempFirstDirect = direct(origin_stopId, transfer_stop[u].stop_id);
        var tempSecondDirect = direct(transfer_stop[u].stop_id, dest_stopId);
        for (var v = 0; v < tempFirstDirect.length; v++) {
            for (var w = 0; w < tempSecondDirect.length; w++) {
                var obj = {
                    "first_bus_to_take": tempFirstDirect[v].bus_to_take,
                    "first_bus_direction": tempFirstDirect[v].direction,
                    "transfer_at": transfer_stop[u].stop_name,
                    "second_bus_to_take": tempSecondDirect[w].bus_to_take,
                    "second_bus_direction": tempSecondDirect[w].direction
                }
                busToTake.push(obj);
            }
        }

    }

    return(busToTake);
}

// transfer method ends here
// [lat, log]
function tripNav(curLocation, dest,res) {
    var potentialStartStop = [];
    var potentialEndStop = [];

    // potential start stop
    var maxDistWalk = 0.15;
    for (var i = 0; i < busList.length; i++) {
        var dist = walkDist(curLocation[0], curLocation[1], busList[i].stop_lat, busList[i].stop_lon);
        if (dist <= maxDistWalk) {
            potentialStartStop.push(busList[i]);
        }
    }

    // potential end stop
    for (var j = 0; j < busList.length; j++) {
        var dist = walkDist(dest[0], dest[1], busList[j].stop_lat, busList[j].stop_lon);
        if (dist <= maxDistWalk) {
            potentialEndStop.push(busList[j]);
        }
    }

    // if user can take one bus
    var directTripNav = []
    for (var p = 0; p < potentialStartStop.length; p++) {
        for (var q = 0; q < potentialEndStop.length; q++) {
            var tempDirect = direct(potentialStartStop[p].stop_id, potentialEndStop[q].stop_id);
            for (var r = 0; r < tempDirect.length; r++) {
                var tripCombo = {
                    "start_from": potentialStartStop[p].stop_name,
                    "take_bus": tempDirect[r],
                    "end_at": potentialEndStop[q].stop_name
                }
                console.log("p:" + p.toString()+" q:"+ q.toString());
                console.log(tripCombo);
                directTripNav.push(tripCombo);
            }
        }
    }
    res.json(directTripNav);


    if (directTripNav.length != 0) {
        return directTripNav;
    } else {
        var transferTripNav = [];
        for (var s = 0; s < potentialStartStop.length; s++) {
            for (var t = 0; t < potentialEndStop.length; t++) {
                var tempTransfer = transfer(potentialStartStop[s].stop_id, potentialEndStop[t].stop_id);
                for (var v = 0; v < tempTransfer.length; v++) {
                    var tripCombo = {
                        "start_from": potentialStartStop[s].stop_name,
                        "two_buses_and_transfer_stops": tempTransfer[v],
                        "end_at": potentialEndStop[t].stop_name
                    }
                    transferTripNav.push(tripCombo);
                }
            }
        }
        console.log("transfer path calculation is finished");
        res.json(transferTripNav);
         //return transferTripNav;
    }
}



// console.log(tripNav([33.77678, -84.38749], [33.77019, -84.39174]));
exports.tripNav = tripNav;


